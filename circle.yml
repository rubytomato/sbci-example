machine:
  java:
    version: oraclejdk8
  environment:
    JAVA_OPTS: -Xms256m -Xmx512m
    log.dir: $HOME/$CIRCLE_PROJECT_REPONAME/log
  timezone: Asia/Tokyo
  pre:
    - echo "Current date $(date +%Y/%m/%d)"
  post:
    - echo "Current date $(date)"

general:
  artifacts:
    - "target/surefire-reports"
    - "target/site"

database:
  post:
    - mysql -u root < $HOME/$CIRCLE_PROJECT_REPONAME/src/main/resources/data/sql/00-database.sql
    - mysql sample_db -u root < $HOME/$CIRCLE_PROJECT_REPONAME/src/main/resources/data/sql/01-schema.sql
    - mysql sample_db -u root < $HOME/$CIRCLE_PROJECT_REPONAME/src/main/resources/data/sql/02-data-customer.sql
    - mysql sample_db -u root < $HOME/$CIRCLE_PROJECT_REPONAME/src/main/resources/data/sql/03-data-orders.sql

test:
  pre:
    - mkdir -p $HOME/$CIRCLE_PROJECT_REPONAME/log/
  override:
    - mvn clean site
  post:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    - find . -type f -regex ".*/surefire-reports/*/.*xml" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \;
    - mkdir -p $CIRCLE_TEST_REPORTS/log/
    - cp $HOME/$CIRCLE_PROJECT_REPONAME/log/*.log $CIRCLE_TEST_REPORTS/log/
